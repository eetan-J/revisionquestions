import React, { useState, useEffect, useRef, useCallback } from 'react';

// Main App component for the Chemistry Quiz
const App = () => {
  // Define quiz questions based on the provided images
  const initialQuestions = [
    {
      questionText: 'Carbohydrates are defined as either polyhydroxy aldehydes or polyhydroxy ketones, or substances that form these compounds on what process?',
      options: ['Oxidation', 'Reduction', 'Hydrolysis', 'Polymerization'],
      correctAnswerIndex: 2, // Hydrolysis
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'Which of the following reagents can distinguish between aldehydes and ketones?',
      options: ['Dilute HCl', 'Neutral water', 'Acidified dichromate solution', 'Sodium hydroxide'],
      correctAnswerIndex: 2, // Acidified dichromate solution
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'The laboratory preparation of esters often involves heating under reflux and the use of a trace of which acid?',
      options: ['Hydrochloric acid', 'Nitric acid', 'Concentrated sulfuric acid', 'Acetic acid'],
      correctAnswerIndex: 2, // Concentrated sulfuric acid
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'Carboxylic acids can be produced by the oxidation of which of the following?',
      options: ['Alkanes or Alkenes', 'Aldehydes or primary alcohols', 'Ketones or tertiary alcohols', 'Ethers or phenols'],
      correctAnswerIndex: 1, // Aldehydes or primary alcohols
      topic: 'Carboxylic Acids (3.5)'
    },
    {
      questionText: 'Why is the protonated form of an amine more soluble in water than its parent molecular amine?',
      options: ['It is less polar.', 'It can form fewer hydrogen bonds.', 'It is an ionic compound.', 'It has a higher molecular weight.'],
      correctAnswerIndex: 2, // It is an ionic compound.
      topic: 'Amines (3.6)'
    },
    {
      questionText: 'Amino acids contain which two functional groups?',
      options: ['Hydroxyl and Carbonyl', 'Amino and Carboxyl', 'Aldehyde and Ketone', 'Ester and Ether'],
      correctAnswerIndex: 1, // Amino and Carboxyl
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What type of reaction combines two organic molecules to form a larger molecule while also releasing another small molecule, such as water?',
      options: ['Hydrolysis reaction', 'Oxidation reaction', 'Condensation reaction', 'Reduction reaction'],
      correctAnswerIndex: 2, // Condensation reaction
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'Which of the following is typically a characteristic of edible oils and fats according to their definition?',
      options: ['They are primarily inorganic compounds.', 'They are esters of propane-1,2,3-triol and various carboxylic acids.', 'They are simple sugars.', 'They are gases at room temperature.'],
      correctAnswerIndex: 1, // They are esters of propane-1,2,3-triol and various carboxylic acids.
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'Primary and secondary alcohols can be distinguished from tertiary alcohols by their reaction with:',
      options: ['A strong base', 'Acidified dichromate solution', 'Neutral saline solution', 'Water at high temperature'],
      correctAnswerIndex: 1, // Acidified dichromate solution
      topic: 'Alcohols (3.2)'
    },
    {
      questionText: 'Amides are formed by the condensation reaction between carboxylic acids and:',
      options: ['Alcohols', 'Ethers', 'Amines', 'Ketones'],
      correctAnswerIndex: 2, // Amines
      topic: 'Amides (3.8)'
    },
    // Adding more questions below based on the provided images
    {
      questionText: 'What type of compound are proteins?',
      options: ['Carbohydrates', 'Polymers of amino acids', 'Lipids', 'Nucleic acids'],
      correctAnswerIndex: 1,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What two functional groups are found in amino acids?',
      options: ['Hydroxyl and aldehyde', 'Carboxyl and amino', 'Ketone and ester', 'Ether and thiol'],
      correctAnswerIndex: 1,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What type of bond links amino acids in protein chains?',
      options: ['Glycosidic bonds', 'Ester bonds', 'Peptide links', 'Hydrogen bonds'],
      correctAnswerIndex: 2,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'Changes in pH and temperature can affect the biological function of a protein. What is this process called?',
      options: ['Hydration', 'Dehydration', 'Denaturation', 'Polymerization'],
      correctAnswerIndex: 2,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'Aldehydes and ketones are produced by the oxidation of what types of alcohols?',
      options: ['Primary and secondary', 'Tertiary and primary', 'Only primary', 'Only secondary'],
      correctAnswerIndex: 0,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'Which test can distinguish aldehydes from ketones by producing a silver mirror?',
      options: ['Fehling\'s test', 'Benedict\'s test', 'Tollens\' reagent', 'Iodoform test'],
      correctAnswerIndex: 2,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'What is the functional group in aldehydes?',
      options: ['-COOH', '-OH', '-CHO', '-CO-'],
      correctAnswerIndex: 2,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'What is the functional group in ketones?',
      options: ['-COOH', '-OH', '-CHO', '-CO-'],
      correctAnswerIndex: 3,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'Disaccharides and polysaccharides are formed by the condensation of what type of monomer units?',
      options: ['Amino acid', 'Monosaccharide', 'Fatty acid', 'Nucleotide'],
      correctAnswerIndex: 1,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'Which of the following is a molecular formula for glucose?',
      options: ['C6H10O5', 'C6H12O6', 'C12H22O11', 'C5H10O5'],
      correctAnswerIndex: 1,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'In what form can glucose react as an aldehyde?',
      options: ['Ring form', 'Chain form', 'Both ring and chain form', 'Neither form'],
      correctAnswerIndex: 1,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'What is the general functional group of alcohols?',
      options: ['-CHO', '-COOH', '-OH', '-NH2'],
      correctAnswerIndex: 2,
      topic: 'Alcohols (3.2)'
    },
    {
      questionText: 'The oxidation of a primary alcohol typically produces an aldehyde, which can then be further oxidized to what?',
      options: ['Ketone', 'Ether', 'Carboxylic acid', 'Alkane'],
      correctAnswerIndex: 2,
      topic: 'Alcohols (3.2)'
    },
    {
      questionText: 'What is the characteristic reaction of carboxylic acids with bases?',
      options: ['Esterification', 'Neutralization to form carboxylate salts', 'Oxidation', 'Reduction'],
      correctAnswerIndex: 1,
      topic: 'Carboxylic Acids (3.5)'
    },
    {
      questionText: 'Why are sodium and potassium carboxylate salts more soluble in water than their parent carboxylic acids?',
      options: ['They are less polar', 'They are ionic compounds', 'They have higher molecular weights', 'They have stronger hydrogen bonding'],
      correctAnswerIndex: 1,
      topic: 'Carboxylic Acids (3.5)'
    },
    {
      questionText: 'What is the functional group of a carboxylic acid?',
      options: ['-CHO', '-COOR', '-COOH', '-CONH2'],
      correctAnswerIndex: 2,
      topic: 'Carboxylic Acids (3.5)'
    },
    {
      questionText: 'Amines act as what type of chemical species?',
      options: ['Acids', 'Bases', 'Neutral compounds', 'Oxidizing agents'],
      correctAnswerIndex: 1,
      topic: 'Amines (3.6)'
    },
    {
      questionText: 'What type of reaction forms esters from carboxylic acids and alcohols?',
      options: ['Hydrolysis', 'Oxidation', 'Condensation', 'Addition'],
      correctAnswerIndex: 2,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What are the products of acidic or alkaline hydrolysis of an ester?',
      options: ['Alcohol and amine', 'Carboxylic acid and alcohol', 'Aldehyde and ketone', 'Alkane and alkene'],
      correctAnswerIndex: 1,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What is a polyester formed from?',
      options: ['Amino acid monomers', 'Glucose monomers', 'Dicarboxylic acid and diol monomers', 'Fatty acid and glycerol monomers'],
      correctAnswerIndex: 2,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What is the amide functional group?',
      options: ['-COOH', '-OH', '-CONH2', '-CHO'],
      correctAnswerIndex: 2,
      topic: 'Amides (3.8)'
    },
    {
      questionText: 'What are the products of acidic or alkaline hydrolysis of an amide?',
      options: ['Carboxylic acid and alcohol', 'Carboxylic acid and amine (or ammonium salt)', 'Aldehyde and ketone', 'Ester and water'],
      correctAnswerIndex: 1,
      topic: 'Amides (3.8)'
    },
    {
      questionText: 'Amides are formed from carboxylic acids and what other functional group?',
      options: ['Alcohols', 'Ethers', 'Amines', 'Ketones'],
      correctAnswerIndex: 2,
      topic: 'Amides (3.8)'
    },
    {
      questionText: 'Edible oils and fats are esters of propane-1,2,3-triol and what other type of compound?',
      options: ['Simple sugars', 'Proteins', 'Various carboxylic acids', 'Inorganic acids'],
      correctAnswerIndex: 2,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'What happens to triglycerides when they are hydrogenated?',
      options: ['They become more unsaturated', 'They become gases', 'They form higher melting point triglycerides', 'They turn into proteins'],
      correctAnswerIndex: 2,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'What is the role of bromine or iodine solution in determining the degree of unsaturation of a compound?',
      options: ['To solidify the compound', 'To cause a color change due to addition reaction with double/triple bonds', 'To make it more soluble in water', 'To increase its melting point'],
      correctAnswerIndex: 1,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'What is a micelle?',
      options: ['A large protein molecule', 'A cluster of surfactant molecules in a liquid', 'A type of carbohydrate', 'A metallic bond'],
      correctAnswerIndex: 1,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'The physical properties of organic compounds are influenced by the molar masses and what other factors?',
      options: ['Their color', 'Their state of matter', 'The number and polarity of functional groups', 'Their smell'],
      correctAnswerIndex: 2,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What term is used to describe the systematic naming of organic compounds to provide unambiguous identification?',
      options: ['Common naming', 'Trivial naming', 'IUPAC nomenclature', 'Descriptive naming'],
      correctAnswerIndex: 2,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What determines if a molecule is a carbohydrate, given its structural formula?',
      options: ['Presence of a benzene ring', 'Presence of polyhydroxy aldehyde or ketone groups', 'Presence of only carbon and hydrogen', 'Presence of nitrogen'],
      correctAnswerIndex: 1,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'What is the maximum number of carbon atoms in the main chain for aldehydes and ketones as discussed?',
      options: ['Four', 'Six', 'Eight', 'Ten'],
      correctAnswerIndex: 2,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'What is the maximum number of carbon atoms in the main chain for alcohols as discussed?',
      options: ['Four', 'Six', 'Eight', 'Ten'],
      correctAnswerIndex: 2,
      topic: 'Alcohols (3.2)'
    },
    {
      questionText: 'What type of reaction results in the formation of an amide from a carboxylic acid and an amine?',
      options: ['Hydrolysis', 'Oxidation', 'Condensation', 'Reduction'],
      correctAnswerIndex: 2,
      topic: 'Amides (3.8)'
    },
    {
      questionText: 'What is the main difference in the structural formula between an aldehyde and a ketone?',
      options: ['Aldehydes have a carboxyl group, ketones do not.', 'Aldehydes have a carbonyl group at the end of a chain, ketones have it in the middle.', 'Ketones have a hydroxyl group, aldehydes do not.', 'Aldehydes have a double bond, ketones do not.'],
      correctAnswerIndex: 1,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'What type of interaction primarily determines the unique spatial arrangement of a protein?',
      options: ['Ionic bonds', 'Covalent bonds', 'Secondary interactions between sections of the chain', 'Metallic bonds'],
      correctAnswerIndex: 2,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What is propane-1,2,3-triol commonly known as?',
      options: ['Ethanol', 'Glycerol', 'Methanol', 'Butanol'],
      correctAnswerIndex: 1,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'How many amino groups can a primary amine contain according to the definition?',
      options: ['Exactly one', 'Exactly two', 'One or more', 'None'],
      correctAnswerIndex: 2,
      topic: 'Amines (3.6)'
    },
    {
      questionText: 'What is the outcome when an amino acid "self-ionises"?',
      options: ['It forms an ester', 'It forms a zwitterion', 'It breaks down into smaller molecules', 'It polymerizes'],
      correctAnswerIndex: 1,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What type of organic compound are derived from ammonia (NH3)?',
      options: ['Alcohols', 'Carboxylic acids', 'Amines', 'Esters'],
      correctAnswerIndex: 2,
      topic: 'Amines (3.6)'
    },
    {
      questionText: 'What product is formed when a carboxylic acid reacts with a carbonate?',
      options: ['An ester', 'An alcohol', 'A carboxylate salt', 'A aldehyde'],
      correctAnswerIndex: 2,
      topic: 'Carboxylic Acids (3.5)'
    },
    {
      questionText: 'Which of the following is NOT a property described as being influenced by the number and polarity of functional groups for organic compounds?',
      options: ['Melting points', 'Boiling points', 'Solubilities in water', 'Color'],
      correctAnswerIndex: 3,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What happens to the structure of a liquid triglyceride when it undergoes hydrogenation?',
      options: ['It becomes more unsaturated', 'It becomes saturated', 'It converts to an amine', 'It evaporates'],
      correctAnswerIndex: 1,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'What defines a primary alcohol?',
      options: ['The carbon atom bonded to the -OH group is bonded to two other carbon atoms.', 'The carbon atom bonded to the -OH group is bonded to three other carbon atoms.', 'The carbon atom bonded to the -OH group is bonded to one other carbon atom.', 'The -OH group is bonded to a benzene ring.'],
      correctAnswerIndex: 2,
      topic: 'Alcohols (3.2)'
    },
    {
      questionText: 'What defines a secondary alcohol?',
      options: ['The carbon atom bonded to the -OH group is bonded to two other carbon atoms.', 'The carbon atom bonded to the -OH group is bonded to three other carbon atoms.', 'The carbon atom bonded to the -OH group is bonded to one other carbon atom.', 'The -OH group is bonded to a benzene ring.'],
      correctAnswerIndex: 0,
      topic: 'Alcohols (3.2)'
    },
    {
      questionText: 'What defines a tertiary alcohol?',
      options: ['The carbon atom bonded to the -OH group is bonded to two other carbon atoms.', 'The carbon atom bonded to the -OH group is bonded to three other carbon atoms.', 'The carbon atom bonded to the -OH group is bonded to one other carbon atom.', 'The -OH group is bonded to a benzene ring.'],
      correctAnswerIndex: 1,
      topic: 'Alcohols (3.2)'
    },
    {
      questionText: 'What functional group is characteristic of an ester?',
      options: ['-OH', '-COOH', '-COO-', '-CONH2'],
      correctAnswerIndex: 2,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'Why is heating under reflux used in the preparation of esters?',
      options: ['To cool the reaction down', 'To increase the reaction rate and prevent loss of volatile reactants/products', 'To solidify the products', 'To remove impurities'],
      correctAnswerIndex: 1,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What is a common use for lower molar mass esters?',
      options: ['As building materials', 'As fuels', 'As food additives due to fruity smells', 'As lubricants'],
      correctAnswerIndex: 2,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What type of polymer is formed from amino acids?',
      options: ['Polysaccharides', 'Polyesters', 'Polyamides', 'Polyethers'],
      correctAnswerIndex: 2,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'Which of these is a disaccharide?',
      options: ['Glucose', 'Fructose', 'Sucrose', 'Starch'],
      correctAnswerIndex: 2,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'What is the repeating unit in a polysaccharide?',
      options: ['Amino acid', 'Monosaccharide', 'Fatty acid', 'Glycerol'],
      correctAnswerIndex: 1,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'What distinguishes primary, secondary, and tertiary amines structurally?',
      options: ['The number of carbons', 'The number of hydrogen atoms attached to the nitrogen atom', 'The number of oxygen atoms', 'The position of the functional group'],
      correctAnswerIndex: 1,
      topic: 'Amines (3.6)'
    },
    {
      questionText: 'What are the products of acidic hydrolysis of an ester?',
      options: ['Alcohol and an amine', 'Carboxylic acid and an alcohol', 'Aldehyde and water', 'Ketone and a salt'],
      correctAnswerIndex: 1,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What is the role of a catalyst in the hydrogenation of liquid triglycerides?',
      options: ['To make the reaction reversible', 'To increase the activation energy', 'To speed up the reaction without being consumed', 'To produce a liquid product'],
      correctAnswerIndex: 2,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'Which is the fourth most abundant element in the universe, and forms four more compounds than all other elements except hydrogen?',
      options: ['Oxygen', 'Nitrogen', 'Carbon', 'Silicon'],
      correctAnswerIndex: 2,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'Organic compounds are widely used in society with applications including fuels, feedstocks, pharmaceuticals, and what other category?',
      options: ['Minerals', 'Water purification', 'Plastics', 'Construction materials'],
      correctAnswerIndex: 2,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What type of bonding is characteristic of organic compounds?',
      options: ['Ionic bonding', 'Metallic bonding', 'Covalent bonding', 'Hydrogen bonding'],
      correctAnswerIndex: 2,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'How are organic compounds named systematically?',
      options: ['Based on their smell', 'Based on their color', 'Using unambiguous identification rules', 'Based on their discovery date'],
      correctAnswerIndex: 2,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What is the definition of a polymer?',
      options: ['A small molecule that reacts with other small molecules to form a larger chain.', 'A large molecule made up of repeating smaller units.', 'A compound that is only made of carbon and hydrogen.', 'A molecule that can only exist as a gas.'],
      correctAnswerIndex: 1,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'Why is it important for organic compounds to be named systematically?',
      options: ['To make them sound more scientific', 'To ensure consistent and unambiguous identification', 'To hide their chemical properties', 'To make them harder to understand'],
      correctAnswerIndex: 1,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What is the primary factor that causes differences in melting points of edible oils and fats?',
      options: ['Color of the oil/fat', 'Presence of impurities', 'Degree of unsaturation', 'Age of the oil/fat'],
      correctAnswerIndex: 2,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'What part of a micelle allows non-polar substances to be transported through an aqueous medium?',
      options: ['The hydrophilic head', 'The hydrophobic tail', 'The ionic core', 'The hydrogen bonds'],
      correctAnswerIndex: 1,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'Which of the following describes the behavior of a tertiary alcohol with acidified dichromate solution?',
      options: ['It is oxidized easily', 'It shows a color change', 'It is not oxidized', 'It forms an aldehyde'],
      correctAnswerIndex: 2,
      topic: 'Alcohols (3.2)'
    },
    {
      questionText: 'What happens to the structure of an aldehyde when it is oxidized?',
      options: ['It becomes an alcohol', 'It becomes a carboxylic acid', 'It becomes a ketone', 'It becomes an ether'],
      correctAnswerIndex: 1,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'What are the products of alkaline hydrolysis of an amide?',
      options: ['Carboxylic acid and an alcohol', 'Carboxylate salt and ammonia/amine', 'Aldehyde and ketone', 'Ester and water'],
      correctAnswerIndex: 1,
      topic: 'Amides (3.8)'
    },
    {
      questionText: 'What is the general formula of an amino acid?',
      options: ['R-COOH', 'R-OH', 'R-NH2', 'A central carbon bonded to an amino group, a carboxyl group, a hydrogen atom, and a variable side chain (R group)'],
      correctAnswerIndex: 3,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'Secondary interactions in proteins are crucial for what aspect of their structure?',
      options: ['Primary structure', 'Unique spatial arrangement', 'Molecular weight', 'Solubility in non-polar solvents'],
      correctAnswerIndex: 1,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'Why might a biological function of a protein be affected by changes in pH?',
      options: ['pH changes the molecular weight of the protein.', 'pH affects the ionization state of amino acid side chains, altering interactions and shape.', 'pH changes the boiling point of the protein.', 'pH removes functional groups from the protein.'],
      correctAnswerIndex: 1,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What is the role of the carboxyl group in an amino acid?',
      options: ['To provide basic properties', 'To form peptide bonds', 'To interact with water', 'To provide acidic properties'],
      correctAnswerIndex: 3,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What is the role of the amino group in an amino acid?',
      options: ['To provide acidic properties', 'To form peptide bonds', 'To interact with non-polar solvents', 'To provide basic properties'],
      correctAnswerIndex: 3,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What happens when a ketone is treated with Tollens\' reagent?',
      options: ['A silver mirror forms', 'A brick-red precipitate forms', 'No observable reaction occurs', 'It turns blue'],
      correctAnswerIndex: 2,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'What is the result of hydrolyzing a disaccharide?',
      options: ['Formation of a polypeptide', 'Breakdown into monosaccharide units', 'Production of an ester', 'Formation of an amide'],
      correctAnswerIndex: 1,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'Which carbon atom count is limited to two in side chains for primary amines?',
      options: ['Up to four carbon atoms in the main chain', 'Up to six carbon atoms in the main chain', 'Up to eight carbon atoms in the main chain', 'More than eight carbon atoms in the main chain'],
      correctAnswerIndex: 2,
      topic: 'Amines (3.6)'
    },
    {
      questionText: 'Carboxylic acids are weak acids and, to a small extent, do what in water?',
      options: ['Boil', 'Vaporize', 'Ionise', 'Solidify'],
      correctAnswerIndex: 2,
      topic: 'Carboxylic Acids (3.5)'
    },
    {
      questionText: 'What is the term for compounds that contain the CON functional group?',
      options: ['Esters', 'Alcohols', 'Amides', 'Ketones'],
      correctAnswerIndex: 2,
      topic: 'Amides (3.8)'
    },
    {
      questionText: 'Why are micelles important in biological systems?',
      options: ['They store genetic information.', 'They facilitate the transport of non-polar substances in aqueous environments.', 'They act as catalysts.', 'They provide structural support.'],
      correctAnswerIndex: 1,
      topic: 'Triglycerides (3.9)'
    },
    {
      questionText: 'Which part of an organic compound largely influences its melting and boiling points?',
      options: ['Its color', 'Its taste', 'Its molar mass and functional groups', 'Its texture'],
      correctAnswerIndex: 2,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What is the process where a protein loses its specific 3D shape due to external factors like heat or pH?',
      options: ['Hydrolysis', 'Synthesis', 'Denaturation', 'Reduction'],
      correctAnswerIndex: 2,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'What distinguishes an "extended" structural formula from a "condensed" structural formula?',
      options: ['Extended shows all bonds, condensed abbreviates bonds and groups.', 'Extended is only for cyclic compounds.', 'Condensed is always for gases.', 'Extended shows only carbon atoms.'],
      correctAnswerIndex: 0,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What is the maximum number of carbon atoms in the main chain for methyl and ethyl esters discussed?',
      options: ['Four', 'Six', 'Eight', 'Ten'],
      correctAnswerIndex: 2,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What is the role of water in the hydrolysis of an ester?',
      options: ['It is a product of the reaction.', 'It is a catalyst.', 'It is a reactant that breaks the ester bond.', 'It is a solvent that does not participate.'],
      correctAnswerIndex: 2,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What kind of structure does an amino acid form when it self-ionizes in solution?',
      options: ['A cation', 'An anion', 'A zwitterion', 'A neutral molecule'],
      correctAnswerIndex: 2,
      topic: 'Proteins (3.10)'
    },
    {
      questionText: 'Which class of organic compounds is generally known for having fruity smells?',
      options: ['Alcohols', 'Carboxylic acids', 'Esters', 'Amines'],
      correctAnswerIndex: 2,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'What is formed when carboxylic acids undergo condensation reactions with alcohols?',
      options: ['Amides', 'Aldehydes', 'Ethers', 'Esters'],
      correctAnswerIndex: 3,
      topic: 'Esters (3.7)'
    },
    {
      questionText: 'How many carbon atoms can be present in side chains for primary amines, as discussed?',
      options: ['One', 'Two', 'Three', 'Four'],
      correctAnswerIndex: 1,
      topic: 'Amines (3.6)'
    },
    {
      questionText: 'What is the general term for substances that form carbohydrates on hydrolysis?',
      options: ['Simple sugars', 'Polymers', 'Polyhydroxy aldehydes or ketones', 'Proteins'],
      correctAnswerIndex: 2,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'What is the most abundant element in the universe, aside from hydrogen?',
      options: ['Oxygen', 'Carbon', 'Nitrogen', 'Helium'],
      correctAnswerIndex: 1,
      topic: 'Introduction (3.1)'
    },
    {
      questionText: 'What type of reaction is the hydrolysis of an amide?',
      options: ['Condensation', 'Addition', 'Elimination', 'Breakdown by water'],
      correctAnswerIndex: 3,
      topic: 'Amides (3.8)'
    },
    {
      questionText: 'When an aldehyde undergoes oxidation, what is the resulting functional group?',
      options: ['-CHO', '-OH', '-COOH', '-CO-'],
      correctAnswerIndex: 2,
      topic: 'Aldehydes and Ketones (3.3)'
    },
    {
      questionText: 'What is the structure of a disaccharide made of?',
      options: ['A single monosaccharide unit', 'Two monosaccharide units linked by a covalent bond', 'Three monosaccharide units', 'A chain of fatty acids'],
      correctAnswerIndex: 1,
      topic: 'Carbohydrates (3.4)'
    },
    {
      questionText: 'What is the name of the reaction that involves the addition of hydrogen to unsaturated compounds?',
      options: ['Oxidation', 'Esterification', 'Hydrogenation', 'Hydrolysis'],
      correctAnswerIndex: 2,
      topic: 'Triglycerides (3.9)'
    }
  ];

  // Utility function to shuffle an array
  const shuffleArray = useCallback((array) => {
    let currentIndex = array.length, randomIndex;
    while (currentIndex !== 0) {
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;
      [array[currentIndex], array[randomIndex]] = [
        array[randomIndex], array[currentIndex]];
    }
    return array;
  }, []);

  // State variables for quiz logic
  const [shuffledQuestions, setShuffledQuestions] = useState([]);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [selectedOption, setSelectedOption] = useState(null);
  const [score, setScore] = useState(0);
  const [showResults, setShowResults] = useState(false);
  const [showFeedback, setShowFeedback] = useState(false); // Controls when feedback (correct/incorrect) is visible
  const [questionKey, setQuestionKey] = useState(0); // Key to trigger question re-render for animation

  // State to track individual question performance
  // This will store cumulative stats across all quiz attempts (including retries)
  const [questionStats, setQuestionStats] = useState(
    initialQuestions.map(q => ({ ...q, correctCount: 0, incorrectCount: 0, attempted: false }))
  );

  // State variables for theme and accent color
  const [isDarkMode, setIsDarkMode] = useState(true); // Default to dark mode
  const [accentColor, setAccentColor] = useState('#6366F1'); // Default accent color (indigo-500)

  // Admin and Progress states
  const [isAdminMode, setIsAdminMode] = useState(false);
  const [adminPassword, setAdminPassword] = useState('');
  const [showAdminPasswordInput, setShowAdminPasswordInput] = useState(false);
  const [showProgressModal, setShowProgressModal] = useState(false);
  const adminPasswordRef = useRef(null); // Ref for password input focus

  // Message state for custom alerts (instead of alert())
  const [message, setMessage] = useState('');
  const [showMessageModal, setShowMessageModal] = useState(false);

  // Function to convert hex to RGB for glassy ripple effect
  const hexToRgb = (hex) => {
    let r = 0, g = 0, b = 0;
    // Handle #RRGGBB or #RGB
    if (hex.length === 7) {
      r = parseInt(hex.substring(1, 3), 16);
      g = parseInt(hex.substring(3, 5), 16);
      b = parseInt(hex.substring(5, 7), 16);
    } else if (hex.length === 4) {
      r = parseInt(hex[1] + hex[1], 16);
      g = parseInt(hex[2] + hex[2], 16);
      b = parseInt(hex[3] + hex[3], 16);
    }
    return `${r}, ${g}, ${b}`;
  };

  // Function to create ripple effect
  const createRipple = useCallback((event) => {
    const button = event.currentTarget;
    const ripple = document.createElement('span');
    const diameter = Math.max(button.clientWidth, button.clientHeight);
    const radius = diameter / 2;

    // Calculate position relative to the button
    const rect = button.getBoundingClientRect();
    ripple.style.width = ripple.style.height = `${diameter}px`;
    ripple.style.left = `${event.clientX - rect.left - radius}px`;
    ripple.style.top = `${event.clientY - rect.top - radius}px`;

    ripple.classList.add('ripple-effect');
    button.appendChild(ripple);

    ripple.onanimationend = () => {
      ripple.remove();
    };
  }, []);

  // Initialize and shuffle questions on component mount
  useEffect(() => {
    setShuffledQuestions(shuffleArray([...initialQuestions]));
  }, [shuffleArray]);

  // Effect to apply/remove dark mode class on <html> element
  useEffect(() => {
    if (isDarkMode) {
      document.documentElement.classList.add('dark');
      document.body.style.backgroundColor = '#111827'; // Tailwind gray-900
    } else {
      document.documentElement.classList.remove('dark');
      document.body.style.backgroundColor = '#F3F4F6'; // Tailwind gray-100
    }
    // Set minimal background
    document.body.style.transition = 'background-color 0.3s ease';
  }, [isDarkMode]);

  // Effect to update CSS variable for accent color
  useEffect(() => {
    const rgb = hexToRgb(accentColor);
    document.documentElement.style.setProperty('--accent-color', accentColor);
    document.documentElement.style.setProperty('--accent-color-rgb', rgb);
  }, [accentColor]);

  // Handle option click (with immediate feedback)
  const handleOptionClick = (optionIndex, event) => {
    if (selectedOption === null) { // Only allow selection if not already answered
      createRipple(event); // Trigger ripple animation
      setSelectedOption(optionIndex);
      setShowFeedback(true); // Show feedback immediately

      // Update question stats
      setQuestionStats(prevStats => {
        const newStats = [...prevStats];
        // Find the original index of the current question in initialQuestions
        const originalQuestion = shuffledQuestions[currentQuestionIndex];
        const originalIndex = initialQuestions.findIndex(q => q.questionText === originalQuestion.questionText);

        if (originalIndex !== -1) {
          if (optionIndex === originalQuestion.correctAnswerIndex) {
            newStats[originalIndex].correctCount += 1;
          } else {
            newStats[originalIndex].incorrectCount += 1;
          }
          newStats[originalIndex].attempted = true; // Mark as attempted
        }
        return newStats;
      });
    }
  };

  // Handle proceeding to the next question or showing results
  const handleNextQuestion = useCallback((event) => {
    if (selectedOption === null) return; // Prevent action if no option is selected

    createRipple(event); // Trigger ripple animation

    // Score update logic remains the same
    if (selectedOption === shuffledQuestions[currentQuestionIndex].correctAnswerIndex) {
      setScore(score + 1);
    }

    // Move to the next question or end the quiz
    if (currentQuestionIndex < shuffledQuestions.length - 1) {
      // Trigger exit animation for current question
      setQuestionKey(prevKey => prevKey + 1); // Change key to force re-render and animation
      setTimeout(() => {
        setCurrentQuestionIndex(currentQuestionIndex + 1);
        setSelectedOption(null);
        setShowFeedback(false);
      }, 300); // Allow time for fade-out animation before changing content
    } else {
      setTimeout(() => {
        setShowResults(true); // End of quiz
        setSelectedOption(null);
        setShowFeedback(false);
      }, 300);
    }
  }, [currentQuestionIndex, shuffledQuestions, selectedOption, score, createRipple]);

  // Handle restarting the quiz
  const handleRestartQuiz = useCallback((event) => {
    createRipple(event); // Trigger ripple animation
    setShuffledQuestions(shuffleArray([...initialQuestions])); // Reshuffle all initial questions
    setCurrentQuestionIndex(0);
    setSelectedOption(null);
    setScore(0);
    setShowResults(false);
    setShowFeedback(false);
    setQuestionKey(0); // Reset key for fresh start
  }, [createRipple, shuffleArray]);

  // Handle retrying wrong questions
  const handleRetryWrongQuestions = useCallback((event) => {
    createRipple(event); // Trigger ripple animation
    const wrongQuestions = questionStats.filter(q => q.incorrectCount > 0);
    if (wrongQuestions.length === 0) {
      showCustomMessage('You got all questions correct! No questions to retry.');
      return;
    }
    setShuffledQuestions(shuffleArray([...wrongQuestions])); // Shuffle only wrong questions
    setCurrentQuestionIndex(0);
    setSelectedOption(null);
    setScore(0);
    setShowResults(false);
    setShowFeedback(false);
    setQuestionKey(0); // Reset key for fresh start
    setShowProgressModal(false); // Close progress modal if open
  }, [createRipple, questionStats, shuffleArray]);


  // Handle admin login
  const handleAdminLogin = useCallback((event) => {
    createRipple(event); // Trigger ripple animation
    if (adminPassword === 'chemistryadmin') { // Simple hardcoded password
      setIsAdminMode(true);
      setShowAdminPasswordInput(false);
      setAdminPassword(''); // Clear password
    } else {
      setMessage('Incorrect password. Please try again.');
      setShowMessageModal(true);
      setAdminPassword('');
    }
  }, [adminPassword, createRipple]);

  // Handle modal close events
  const handleAdminModalClose = useCallback((event) => {
    createRipple(event);
    setIsAdminMode(false);
  }, [createRipple]);

  const handleProgressModalClose = useCallback((event) => {
    createRipple(event);
    setShowProgressModal(false);
  }, [createRipple]);

  const handleAdminPasswordCancel = useCallback((event) => {
    createRipple(event);
    setShowAdminPasswordInput(false);
    setAdminPassword('');
  }, [createRipple]);

  const handleMessageModalClose = useCallback((event) => {
    createRipple(event);
    setShowMessageModal(false);
  }, [createRipple]);

  // Helper for custom message box (used directly now)
  const showCustomMessage = (msg) => {
    setMessage(msg);
    setShowMessageModal(true);
  };

  // Determine button text based on quiz progress
  const buttonText = currentQuestionIndex === shuffledQuestions.length - 1 ? 'Submit Quiz' : 'Next Question';

  return (
    <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-inter transition-colors duration-300">
      <style>{`
        :root {
          --accent-color: #6366F1; /* Default accent color */
          --accent-color-rgb: 99, 102, 241; /* Default RGB for ripple */
        }
        .accent-bg {
          background-color: var(--accent-color);
        }
        .accent-text {
          color: var(--accent-color);
        }
        .accent-border {
          border-color: var(--accent-color);
        }
        .option-button.correct {
          background-color: #10B981; /* Green-500 */
          color: white;
          border-color: #10B981;
        }
        .option-button.incorrect {
          background-color: #EF4444; /* Red-500 */
          color: white;
          border-color: #EF4444;
        }
        .option-button.correct-after-incorrect {
          background-color: #22C55E; /* Green-500 for showing correct after incorrect */
          color: white;
          border-color: #22C55E;
          animation: highlightCorrect 0.5s ease-out;
        }

        @keyframes highlightCorrect {
          0% { transform: scale(1); opacity: 0.7; }
          50% { transform: scale(1.02); opacity: 1; }
          100% { transform: scale(1); }
        }

        /* Fluent question transition */
        .question-enter {
          opacity: 0;
          transform: translateY(20px);
        }
        .question-enter-active {
          opacity: 1;
          transform: translateY(0);
          transition: opacity 300ms ease-out, transform 300ms ease-out;
        }
        .question-exit {
          opacity: 1;
          transform: translateY(0);
        }
        .question-exit-active {
          opacity: 0;
          transform: translateY(-20px);
          transition: opacity 300ms ease-out, transform 300ms ease-out;
        }

        /* Dot animation for theme toggle */
        .dot {
          transition: transform 0.3s ease-in-out, background-color 0.3s ease;
        }
        .sr-only:checked + .block {
          background-color: #6B7280; /* Gray-600 */
        }

        /* Ripple Effect Styles */
        .ripple-button {
          position: relative;
          overflow: hidden;
          transform: translate3d(0, 0, 0); /* Ensures the element creates a new stacking context for children */
        }
        .ripple-effect {
          position: absolute;
          border-radius: 50%;
          background-color: rgba(var(--accent-color-rgb), 0.3); /* Glassy ripple using accent color */
          animation: ripple 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; /* Smoother curve */
          pointer-events: none; /* Allows clicks to pass through */
          z-index: 1; /* Ensures ripple is above button content */
        }

        @keyframes ripple {
          0% {
            transform: scale(0);
            opacity: 1;
          }
          100% {
            transform: scale(2); /* Scale up a bit less to contain within button sometimes */
            opacity: 0;
          }
        }
      `}</style>

      {/* Header with Theme and Accent Color Pickers */}
      <header className="w-full max-w-3xl flex flex-col sm:flex-row justify-between items-center mb-8 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md transition-colors duration-300 z-10">
        <h1 className="text-3xl font-bold accent-text mb-4 sm:mb-0">Chemistry Quiz</h1>
        <div className="flex items-center space-x-4">
          {/* Theme Toggle */}
          <label htmlFor="themeToggle" className="flex items-center cursor-pointer">
            <div className="relative">
              <input
                type="checkbox"
                id="themeToggle"
                className="sr-only"
                checked={isDarkMode}
                onChange={() => setIsDarkMode(!isDarkMode)}
              />
              <div className="block bg-gray-600 w-14 h-8 rounded-full"></div>
              <div
                className={`dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transform ${
                  isDarkMode ? 'translate-x-full bg-gray-900' : 'translate-x-0 bg-gray-100'
                }`}
              ></div>
            </div>
            <span className="ml-3 text-sm font-medium text-gray-700 dark:text-gray-300">
              {isDarkMode ? 'Dark Mode' : 'Light Mode'}
            </span>
          </label>

          {/* Accent Color Picker */}
          <div className="flex items-center">
            <label htmlFor="accentColor" className="mr-2 text-sm font-medium text-gray-700 dark:text-gray-300">
              Accent:
            </label>
            <input
              type="color"
              id="accentColor"
              className="w-8 h-8 rounded-full border-none cursor-pointer"
              value={accentColor}
              onChange={(e) => setAccentColor(e.target.value)}
              title="Change Accent Color"
            />
          </div>
        </div>
      </header>

      {/* Quiz Content Area */}
      <div key={questionKey} className={`w-full max-w-3xl bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 transition-all duration-300 ${showResults ? '' : 'question-enter-active'}`}>
        {showResults ? (
          // Results Screen
          <div className="text-center">
            <h2 className="text-3xl font-bold accent-text mb-4">Quiz Results</h2>
            <p className="text-xl mb-6">
              You scored {score} out of {shuffledQuestions.length} questions correctly!
            </p>            <button
              onClick={handleRestartQuiz}
              className="accent-bg text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-300 ripple-button"
            >
              Start New Quiz
            </button>

          </div>
        ) : (
          // Question Screen
          <div>
            <div className="mb-6">
              <h2 className="text-2xl font-bold mb-2">
                Question {currentQuestionIndex + 1}/{shuffledQuestions.length}
              </h2>
              <p className="text-lg mb-4 text-gray-700 dark:text-gray-300">
                <span className="font-semibold">{shuffledQuestions[currentQuestionIndex]?.topic}:</span> {shuffledQuestions[currentQuestionIndex]?.questionText}
              </p>
            </div>

            {/* Options */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
              {shuffledQuestions[currentQuestionIndex]?.options.map((option, index) => (
                <button
                  key={index}
                  onClick={(e) => handleOptionClick(index, e)}
                  disabled={selectedOption !== null} // Disable after an option is selected
                  className={`
                    option-button p-4 rounded-lg border-2 text-left ripple-button
                    ${
                      showFeedback && index === shuffledQuestions[currentQuestionIndex].correctAnswerIndex
                        ? 'correct-after-incorrect' // Always highlight correct if feedback is showing
                        : selectedOption === index
                          ? selectedOption === shuffledQuestions[currentQuestionIndex].correctAnswerIndex
                            ? 'correct' // Selected and correct
                            : 'incorrect' // Selected and incorrect
                          : 'border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600'
                    }
                    transition-all duration-200 ease-in-out
                    focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)] focus:ring-opacity-75
                    transform active:scale-95
                  `}
                >
                  <span className="font-semibold mr-2">
                    {String.fromCharCode(65 + index)}.
                  </span>
                  {option}
                </button>
              ))}
            </div>

            {/* Feedback Message */}
            {showFeedback && (
              <div className={`text-center text-lg font-semibold mb-4
                ${selectedOption === shuffledQuestions[currentQuestionIndex].correctAnswerIndex ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}
              `}>
                {selectedOption === shuffledQuestions[currentQuestionIndex].correctAnswerIndex
                  ? 'Correct! Well done.'
                  : `Incorrect. The correct answer was: ${shuffledQuestions[currentQuestionIndex].options[shuffledQuestions[currentQuestionIndex].correctAnswerIndex]}.`
                }
              </div>
            )}

            {/* Navigation Button */}
            <button
              onClick={handleNextQuestion}
              disabled={selectedOption === null}
              className={`
                w-full py-3 px-6 rounded-full font-semibold shadow-md ripple-button
                ${selectedOption === null
                  ? 'bg-gray-300 dark:bg-gray-600 text-gray-500 cursor-not-allowed'
                  : 'accent-bg text-white hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-300'
                }
              `}
            >
              {buttonText}
            </button>
          </div>
        )}
      </div>

      {/* Footer with Admin and Progress Toggle Buttons */}
      <footer className="mt-8 text-center text-gray-600 dark:text-gray-400 text-sm flex justify-center space-x-4">
        <p>&copy; 2025 Chemistry Quiz App.</p>
        <button
          onClick={(e) => {createRipple(e); setShowProgressModal(true);}}
          className="text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 focus:outline-none ripple-button px-2 py-1 rounded"
        >
          Progress
        </button>
        <button
          onClick={(e) => {createRipple(e); handleRetryWrongQuestions(e);}} /* Modified for instant retry */
          className="text-xs text-yellow-600 dark:text-yellow-400 hover:text-yellow-700 dark:hover:text-yellow-200 focus:outline-none ripple-button px-2 py-1 rounded"
        >
          Retry Wrong Questions
        </button>
        <button
          onClick={(e) => {createRipple(e); setShowAdminPasswordInput(true);}}
          className="text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 focus:outline-none ripple-button px-2 py-1 rounded"
        >
          Admin
        </button>
      </footer>

      {/* Admin Password Input Modal */}
      {showAdminPasswordInput && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl w-80 text-center">
            <h3 className="text-xl font-bold mb-4 text-gray-900 dark:text-gray-100">Enter Admin Password</h3>
            <input
              type="password"
              className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md mb-4 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]"
              value={adminPassword}
              onChange={(e) => setAdminPassword(e.target.value)}
              onKeyPress={(e) => {
                if (e.key === 'Enter') handleAdminLogin(e); // Pass event here
              }}
              ref={adminPasswordRef}
            />
            <div className="flex justify-around">
              <button
                onClick={handleAdminLogin}
                className="accent-bg text-white font-semibold py-2 px-4 rounded-md shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-200 ripple-button"
              >
                Login
              </button>
              <button
                onClick={handleAdminPasswordCancel}
                className="bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold py-2 px-4 rounded-md shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-200 ripple-button"
              >
                Cancel
              </button>
            </div>
            {message && <p className="text-red-500 mt-3">{message}</p>}
          </div>
        </div>
      )}

      {/* Admin View Modal */}
      {isAdminMode && (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-40 p-4">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-4xl w-full h-[90vh] overflow-y-auto text-gray-900 dark:text-gray-100 relative">
            <h3 className="text-2xl font-bold accent-text mb-4 text-center">Admin View: All Questions</h3>
            <button
              onClick={handleAdminModalClose}
              className="absolute top-4 right-4 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold hover:bg-red-600 transition-colors duration-200 ripple-button"
            >
              X
            </button>
            <div className="space-y-6">
              {questionStats.map((q, qIndex) => ( // Use questionStats for admin view too
                <div key={qIndex} className="p-4 border border-gray-200 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-700 shadow-sm">
                  <p className="font-semibold text-lg mb-2">{qIndex + 1}. {q.questionText} <span className="text-gray-500 text-sm">({q.topic})</span></p>
                  <ul className="list-disc pl-5 space-y-1">
                    {q.options.map((option, oIndex) => (
                      <li key={oIndex} className={`${oIndex === q.correctAnswerIndex ? 'text-green-600 dark:text-green-400 font-medium' : 'text-gray-700 dark:text-gray-300'}`}>
                        {String.fromCharCode(65 + oIndex)}. {option}
                        {oIndex === q.correctAnswerIndex && <span className="ml-2 text-green-700 dark:text-green-300">(Correct)</span>}
                      </li>
                    ))}
                  </ul>
                  <p className="text-sm text-gray-600 dark:text-gray-400 mt-2">
                    Stats: Correct: {q.correctCount}, Incorrect: {q.incorrectCount}
                  </p>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* Progress Modal */}
      {showProgressModal && (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-40 p-4">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-4xl w-full h-[90vh] overflow-y-auto text-gray-900 dark:text-gray-100 relative">
            <h3 className="text-2xl font-bold accent-text mb-4 text-center">Your Progress</h3>
            <button
              onClick={handleProgressModalClose}
              className="absolute top-4 right-4 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold hover:bg-red-600 transition-colors duration-200 ripple-button"
            >
              X
            </button>

            {/* Overall Stats */}
            <div className="mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-700 shadow-sm">
              <h4 className="text-xl font-semibold mb-2">Overall Performance</h4>
              <p>Total Questions in Quiz: {initialQuestions.length}</p>
              <p>Questions Attempted (at least once): {questionStats.filter(q => q.attempted).length}</p>
              <p>Total Correct Answers Across All Attempts: {questionStats.reduce((sum, q) => sum + q.correctCount, 0)}</p>
              <p>Total Incorrect Answers Across All Attempts: {questionStats.reduce((sum, q) => sum + q.incorrectCount, 0)}</p>
              <p className="font-bold text-lg">
                Overall Accuracy (of attempted questions):{' '}
                {questionStats.filter(q => q.attempted).length > 0
                  ? (questionStats.reduce((sum, q) => sum + q.correctCount, 0) / questionStats.reduce((sum, q) => sum + q.correctCount + q.incorrectCount, 0) * 100).toFixed(2)
                  : 'N/A'}%
              </p>
            </div>

            {/* Performance by Topic */}
            <div className="mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-700 shadow-sm">
              <h4 className="text-xl font-semibold mb-2">Performance by Topic</h4>
              {Object.entries(questionStats.reduce((acc, q) => {
                if (!acc[q.topic]) {
                  acc[q.topic] = { correct: 0, incorrect: 0, total: 0 };
                }
                acc[q.topic].correct += q.correctCount;
                acc[q.topic].incorrect += q.incorrectCount;
                acc[q.topic].total += (q.correctCount + q.incorrectCount);
                return acc;
              }, {})).map(([topic, stats]) => (
                <p key={topic} className="mb-1">
                  <span className="font-medium">{topic}:</span>{' '}
                  {stats.total > 0
                    ? `${((stats.correct / stats.total) * 100).toFixed(2)}% Correct (${stats.correct} / ${stats.total})`
                    : 'Not attempted yet'}
                </p>
              ))}
            </div>

            {/* Questions to Review */}
            <div className="p-4 border border-gray-200 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-700 shadow-sm">
              <h4 className="text-xl font-semibold mb-2">Questions to Review (Answered Incorrectly)</h4>
              {questionStats.filter(q => q.incorrectCount > 0)
                           .sort((a, b) => b.incorrectCount - a.incorrectCount) // Sort by most incorrect
                           .map((q, index) => (
                <div key={index} className="mb-3 border-b border-gray-200 dark:border-gray-600 pb-2 last:border-b-0">
                  <p className="font-medium">{index + 1}. {q.questionText} <span className="text-gray-500 text-sm">({q.topic})</span></p>
                  <p className="text-sm text-red-500 dark:text-red-400">Incorrect Attempts: {q.incorrectCount}</p>
                  <p className="text-sm text-green-500 dark:text-green-400">Correct Answer: {q.options[q.correctAnswerIndex]}</p>
                </div>
              ))}
              {questionStats.filter(q => q.incorrectCount > 0).length === 0 && (
                <p className="text-center text-gray-500 dark:text-gray-400">Great job! No questions to review currently.</p>
              )}
            </div>
          </div>
        </div>
      )}

      {/* Custom Message Modal */}
      {showMessageModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl w-80 text-center">
            <h3 className="text-xl font-bold mb-4 text-gray-900 dark:text-gray-100">Message</h3>
            <p className="mb-4 text-gray-700 dark:text-gray-300">{message}</p>
            <button
              onClick={handleMessageModalClose}
              className="accent-bg text-white font-semibold py-2 px-4 rounded-md shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-200 ripple-button"
            >
              Close
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

export default App;
